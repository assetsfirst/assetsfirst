"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([[975],{4975:(Qe,w,l)=>{l.r(w),l.d(w,{PortfolioPositionsModule:()=>Ze});var h=l(6895),I=l(2761),B=l(8675),F=l(9300),H=l(5577),j=l(4004),u=l(5412),v=l(9521),t=l(4650),P=l(6299),g=l(4006),T=l(4859),y=l(7392),m=l(7331),C=l(9549),E=l(266),D=l(7957),p=l(3238);const Z=["tagInput"];function Q(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"mat-chip",12),t.NdJ("removed",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.remove(r))}),t._uU(1),t.TgZ(2,"button",13)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&a){const e=o.$implicit;t.xp6(1),t.hij(" ",e.categoryName+"::"+e.name," ")}}function G(a,o){if(1&a&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&a){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.categoryName+"::"+e.name," ")}}const $=function(){return{openTagCategoriesDialog:!0}},V=function(a){return{selectedTags:a}};let q=(()=>{class a{constructor(e,i,n,r){this.tagCategoryService=e,this.data=i,this.cd=n,this.fb=r,this.separatorKeysCodes=[v.K5,v.OC],this.selectedTags=[],this.title=i.title,this.selectedTags=[...i.selectedTags],this.tagCtrl=this.fb.control("")}ngOnInit(){this.filteredTags$=this.tagCtrl.valueChanges.pipe((0,B.O)(""),(0,F.h)(e=>"string"==typeof e),(0,H.z)(e=>this.tagCategoryService.findTags(e).pipe((0,j.U)(i=>i.content))))}add(e){(e.value||"").trim(),e.chipInput.clear(),this.tagCtrl.setValue("")}remove(e){this.selectedTags=[...this.selectedTags.filter(i=>i.id!==e.id)],this.cd.detectChanges()}selected(e){this.tagInput.nativeElement.value="",this.tagCtrl.setValue(""),this.selectedTags=[...this.selectedTags,e.option.value],this.cd.detectChanges()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(P.$),t.Y36(u.WI),t.Y36(t.sBO),t.Y36(g.j3))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-position-tags-dialog"]],viewQuery:function(e,i){if(1&e&&t.Gf(Z,5),2&e){let n;t.iGM(n=t.CRH())&&(i.tagInput=n.first)}},decls:22,vars:14,consts:[["mat-dialog-title",""],["mat-icon-button","","matTooltip","Configure Tag Categories",1,"conf-categories-btn",3,"mat-dialog-close"],["appearance","fill",1,"tag-chip-list"],["aria-label","Tag selection"],["chipList",""],[3,"removed",4,"ngFor","ngForOf"],["placeholder","New tag...",3,"formControl","matChipInputFor","matAutocomplete","matChipInputSeparatorKeyCodes","matChipInputTokenEnd"],["tagInput",""],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"mat-dialog-close"],[3,"removed"],["matChipRemove",""],[3,"value"]],template:function(e,i){if(1&e&&(t.TgZ(0,"h2",0),t._uU(1),t.TgZ(2,"span")(3,"button",1)(4,"mat-icon"),t._uU(5,"settings_ethernet"),t.qZA()()()(),t.TgZ(6,"mat-dialog-content")(7,"mat-form-field",2)(8,"mat-label"),t._uU(9,"Position Tags"),t.qZA(),t.TgZ(10,"mat-chip-list",3,4),t.YNc(12,Q,5,1,"mat-chip",5),t.TgZ(13,"input",6,7),t.NdJ("matChipInputTokenEnd",function(r){return i.add(r)}),t.qZA()(),t.TgZ(15,"mat-autocomplete",8,9),t.NdJ("optionSelected",function(r){return i.selected(r)}),t.YNc(17,G,2,2,"mat-option",10),t.ALo(18,"async"),t.qZA()()(),t.TgZ(19,"mat-dialog-actions")(20,"button",11),t._uU(21,"Okay"),t.qZA()()),2&e){const n=t.MAs(11),r=t.MAs(16);t.xp6(1),t.hij(" ",i.title,""),t.xp6(2),t.Q6J("mat-dialog-close",t.DdM(11,$)),t.xp6(9),t.Q6J("ngForOf",i.selectedTags),t.xp6(1),t.Q6J("formControl",i.tagCtrl)("matChipInputFor",n)("matAutocomplete",r)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes),t.xp6(4),t.Q6J("ngForOf",t.lcZ(18,9,i.filteredTags$)),t.xp6(3),t.Q6J("mat-dialog-close",t.VKq(12,V,i.selectedTags))}},dependencies:[h.sg,T.lW,y.Hw,u.ZT,u.uh,u.xY,u.H8,m.qn,m.HS,m.oH,m.qH,C.KE,C.hX,g.Fj,g.JJ,g.oH,E.gM,D.XC,D.ZL,p.ey,h.Ov],styles:[".tag-chip-list[_ngcontent-%COMP%]{width:100%}"],changeDetection:0}),a})();function U(a){return`${a.symbol}.${a.exchange}`}var f=l(7084),z=l(1520),A=l(4144);function W(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"mat-chip",10),t.NdJ("removed",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.removeTag(s.category,r))}),t._uU(1),t.TgZ(2,"button",11)(3,"mat-icon"),t._uU(4,"cancel"),t.qZA()()()}if(2&a){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}let Y=(()=>{class a{constructor(e){this.fb=e,this.separatorKeysCodes=[v.K5,v.OC],this.categoryDeleted=new t.vpe,this.categoryChanged=new t.vpe}ngOnInit(){this.form=this.fb.group({name:[this.category.name,g.kI.required]}),this.tags=[...this.category.tags],this.form.get("name")?.valueChanges.pipe((0,B.O)(this.category.name),(0,z.G)()).subscribe(([e,i])=>{this.categoryChanged.emit({name:e,category:{...this.latestCategoryState,name:i}})})}removeTag(e,i){this.tags=[...this.tags.filter(n=>n.id!==i.id)],this.categoryChanged.emit({name:this.form.get("name")?.value,category:this.latestCategoryState})}addTag(e,i){const n=(i.value||"").trim();n&&!this.tags.some(r=>r.name===n)&&(this.tags=[...this.tags,{name:n}],i.chipInput.clear(),this.categoryChanged.emit({name:this.form.get("name")?.value,category:this.latestCategoryState}))}deleteCategory(){this.categoryDeleted.emit(this.latestCategoryState)}get latestCategoryState(){return Object.assign({},this.category,this.form.value,{tags:this.tags})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(g.j3))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-tag-category-control"]],inputs:{category:"category"},outputs:{categoryDeleted:"categoryDeleted",categoryChanged:"categoryChanged"},decls:16,vars:6,consts:[[1,"category-control-panel"],[3,"formGroup"],["appearance","fill",1,"category-name"],["matInput","","type","text","id","name","placeholder","Name","formControlName","name","autofocus",""],["appearance","fill",1,"category-tags-list"],["aria-label","Tag selection","multiple",""],["categoriesTags",""],[3,"removed",4,"ngFor","ngForOf"],["placeholder","New Tag...",3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["mat-button","","color","warn",3,"click"],[3,"removed"],["matChipRemove",""]],template:function(e,i){if(1&e&&(t.TgZ(0,"mat-expansion-panel",0)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),t._uU(3),t.qZA(),t._UZ(4,"mat-panel-description"),t.qZA(),t.TgZ(5,"form",1)(6,"mat-form-field",2),t._UZ(7,"input",3),t.qZA(),t.TgZ(8,"mat-form-field",4)(9,"mat-chip-list",5,6),t.YNc(11,W,5,1,"mat-chip",7),t.TgZ(12,"input",8),t.NdJ("matChipInputTokenEnd",function(r){return i.addTag(i.category,r)}),t.qZA()()()(),t.TgZ(13,"mat-action-row")(14,"button",9),t.NdJ("click",function(){return i.deleteCategory()}),t._uU(15,"Delete"),t.qZA()()()),2&e){const n=t.MAs(10);let r;t.xp6(3),t.hij(" ",null==(r=i.form.get("name"))?null:r.value," "),t.xp6(2),t.Q6J("formGroup",i.form),t.xp6(6),t.Q6J("ngForOf",i.tags),t.xp6(1),t.Q6J("matChipInputFor",n)("matChipInputSeparatorKeyCodes",i.separatorKeysCodes)("matChipInputAddOnBlur",!0)}},dependencies:[h.sg,T.lW,y.Hw,m.qn,m.HS,m.oH,m.qH,C.KE,g._Y,g.Fj,g.JJ,g.JL,g.sg,g.u,f.ib,f.VG,f.yz,f.yK,f.u4,A.Nt],styles:[".category-name[_ngcontent-%COMP%], .category-tags-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .category-control-panel[_ngcontent-%COMP%]:last-of-type{border-bottom-right-radius:0;border-bottom-left-radius:0;margin-bottom:5px}[_nghost-%COMP%]   .category-control-panel[_ngcontent-%COMP%]:first-of-type{border-top-right-radius:0;border-top-left-radius:0}"],changeDetection:0}),a})();function J(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"app-tag-category-control",4),t.NdJ("categoryChanged",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.handleCategoryChanged(n))})("categoryDeleted",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.handleCategoryDeleted(n))}),t.qZA()}2&a&&t.Q6J("category",o.$implicit)}function K(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"app-tag-category-control",4),t.NdJ("categoryChanged",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.handleCategoryChanged(n))})("categoryDeleted",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.handleCategoryDeleted(n))}),t.qZA()}2&a&&t.Q6J("category",o.$implicit)}let X=(()=>{class a{constructor(e,i,n){this.tagCategoryService=e,this.cd=i,this.dialogRef=n,this.separatorKeysCodes=[v.K5,v.OC],this.newCategoryName="New Tag Category",this.categoriesToDelete=[]}ngOnInit(){this.tagCategoryService.getTagCategories().subscribe(e=>{this.persistedCategories=e,this.newCategories=[],this.categoriesState=JSON.parse(JSON.stringify(this.persistedCategories)),this.cd.detectChanges()})}onOkayClick(){const e=this.categoriesState.filter(r=>!r.id),i=this.persistedCategories.reduce((r,s)=>({...r,[s.id]:s}),{}),n=this.categoriesState.filter(r=>!!r.id&&JSON.stringify(r)!==JSON.stringify(i[r.id]));this.dialogRef.close({add:e,update:n,delete:this.categoriesToDelete})}addCategory(){const e={id:null,name:this.generateNewCategoryName(),color:"#999",tags:[]};this.newCategories=[e,...this.newCategories],this.categoriesState=[e,...this.categoriesState],this.cd.detectChanges()}generateNewCategoryName(){const e=this.categoriesState.find(n=>n.name.startsWith(this.newCategoryName));if(!e)return this.newCategoryName;let i;return i=e.name===this.newCategoryName?" 2":" "+(+e.name[e.name.length-1]+1),this.newCategoryName+i}handleCategoryChanged({name:e,category:i}){this.categoriesState=this.categoriesState.map(n=>n.name===e?i:n)}handleCategoryDeleted(e){e.id&&(this.categoriesToDelete=[...this.categoriesToDelete,e.id]),this.newCategories=[...this.newCategories.filter(i=>i.name!==e.name)],this.persistedCategories=[...this.persistedCategories.filter(i=>i.name!==e.name)],this.categoriesState=[...this.categoriesState.filter(i=>i.name!==e.name)],this.cd.detectChanges()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(P.$),t.Y36(t.sBO),t.Y36(u.so))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-tag-categories-dialog"]],decls:13,vars:3,consts:[["mat-dialog-title","",1,"dialog-title"],["mat-button","",1,"add-category-btn",3,"click"],[3,"category","categoryChanged","categoryDeleted",4,"ngFor","ngForOf"],["mat-button","",3,"click"],[3,"category","categoryChanged","categoryDeleted"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2),t.qZA(),t.TgZ(3,"button",1),t.NdJ("click",function(){return i.addCategory()}),t.TgZ(4,"mat-icon"),t._uU(5,"add"),t.qZA()()(),t.TgZ(6,"mat-dialog-content")(7,"mat-accordion"),t.YNc(8,J,1,1,"app-tag-category-control",2),t.YNc(9,K,1,1,"app-tag-category-control",2),t.qZA()(),t.TgZ(10,"mat-dialog-actions")(11,"button",3),t.NdJ("click",function(){return i.onOkayClick()}),t._uU(12,"Okay"),t.qZA()()),2&e&&(t.xp6(2),t.Oqu("Tag Categories"),t.xp6(6),t.Q6J("ngForOf",i.newCategories),t.xp6(1),t.Q6J("ngForOf",i.persistedCategories))},dependencies:[h.sg,T.lW,y.Hw,u.uh,u.xY,u.H8,f.pp,Y],styles:[".spinner-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.dialog-title[_ngcontent-%COMP%]{display:inline-flex}.dialog-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}"],changeDetection:0}),a})();var ee=l(590),te=l(4128),ie=l(529);let S=(()=>{class a{constructor(e){this.http=e}getPortfolioPositions(){return this.http.get("/portfolio-positions")}getPortfolioPositionsView(e){return this.http.get(`/portfolio-positions/view?hideSold=${e}`)}updatePositionTags(e,i){return this.http.post(`/portfolio-positions/${e}/tags`,i)}}return a.\u0275fac=function(e){return new(e||a)(t.LFG(ie.eN))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var ae=l(894);class ne{constructor(){this.positions=[]}}let L=(()=>{class a extends ae.y{constructor(){super(new ne)}init(e,i){const n=this.sortPositions(e,i);this.setState({...this.state,positions:n})}updatePositionTags(e,i){const n=this.state.positions.map(r=>r.id===e?{...r,tags:i}:r);this.setState({...this.state,positions:n})}sortPositions(e,i){return e.sort((n,r)=>{const s=i.active;let c=n[s],d=r[s];return"desc"===i.direction&&([c,d]=[d,c]),"string"==typeof c?c.localeCompare(d):c-d})}reorderExistingPositions(e){this.init(this.state.positions,e)}}return a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac}),a})();var x=l(2687),M=l(1281);let oe=0;const re=(0,p.Id)(class{}),O="mat-badge-content";let se=(()=>{class a extends re{constructor(e,i,n,r,s){super(),this._ngZone=e,this._elementRef=i,this._ariaDescriber=n,this._renderer=r,this._animationMode=s,this._color="primary",this._overlap=!0,this.position="above after",this.size="medium",this._id=oe++,this._isInitialized=!1}get color(){return this._color}set color(e){this._setColor(e),this._color=e}get overlap(){return this._overlap}set overlap(e){this._overlap=(0,M.Ig)(e)}get content(){return this._content}set content(e){this._updateRenderedContent(e)}get description(){return this._description}set description(e){this._updateHostAriaDescription(e)}get hidden(){return this._hidden}set hidden(e){this._hidden=(0,M.Ig)(e)}isAbove(){return-1===this.position.indexOf("below")}isAfter(){return-1===this.position.indexOf("before")}getBadgeElement(){return this._badgeElement}ngOnInit(){this._clearExistingBadges(),this.content&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement(),this._updateRenderedContent(this.content)),this._isInitialized=!0}ngOnDestroy(){this._renderer.destroyNode&&this._renderer.destroyNode(this._badgeElement),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description)}_createBadgeElement(){const e=this._renderer.createElement("span"),i="mat-badge-active";return e.setAttribute("id",`mat-badge-content-${this._id}`),e.setAttribute("aria-hidden","true"),e.classList.add(O),"NoopAnimations"===this._animationMode&&e.classList.add("_mat-animation-noopable"),this._elementRef.nativeElement.appendChild(e),"function"==typeof requestAnimationFrame&&"NoopAnimations"!==this._animationMode?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{e.classList.add(i)})}):e.classList.add(i),e}_updateRenderedContent(e){const i=`${e??""}`.trim();this._isInitialized&&i&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement()),this._badgeElement&&(this._badgeElement.textContent=i),this._content=i}_updateHostAriaDescription(e){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description),e&&this._ariaDescriber.describe(this._elementRef.nativeElement,e),this._description=e}_setColor(e){const i=this._elementRef.nativeElement.classList;i.remove(`mat-badge-${this._color}`),e&&i.add(`mat-badge-${e}`)}_clearExistingBadges(){const e=this._elementRef.nativeElement.querySelectorAll(`:scope > .${O}`);for(const i of Array.from(e))i!==this._badgeElement&&i.remove()}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(t.R0b),t.Y36(t.SBq),t.Y36(x.$s),t.Y36(t.Qsj),t.Y36(t.QbO,8))},a.\u0275dir=t.lG2({type:a,selectors:[["","matBadge",""]],hostAttrs:[1,"mat-badge"],hostVars:20,hostBindings:function(e,i){2&e&&t.ekj("mat-badge-overlap",i.overlap)("mat-badge-above",i.isAbove())("mat-badge-below",!i.isAbove())("mat-badge-before",!i.isAfter())("mat-badge-after",i.isAfter())("mat-badge-small","small"===i.size)("mat-badge-medium","medium"===i.size)("mat-badge-large","large"===i.size)("mat-badge-hidden",i.hidden||!i.content)("mat-badge-disabled",i.disabled)},inputs:{disabled:["matBadgeDisabled","disabled"],color:["matBadgeColor","color"],overlap:["matBadgeOverlap","overlap"],position:["matBadgePosition","position"],content:["matBadge","content"],description:["matBadgeDescription","description"],size:["matBadgeSize","size"],hidden:["matBadgeHidden","hidden"]},features:[t.qOj]}),a})(),le=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[x.rt,p.BQ,p.BQ]}),a})();var R=l(6308);function ce(a,o){if(1&a&&(t.TgZ(0,"div",6),t._uU(1),t.qZA()),2&a){const e=t.oxw().$implicit;t.Q6J("mat-sort-header",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function de(a,o){if(1&a&&(t.TgZ(0,"div",7),t._uU(1),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.name)}}function ge(a,o){if(1&a&&(t.ynx(0),t.YNc(1,ce,2,2,"div",4),t.YNc(2,de,2,1,"ng-template",null,5,t.W1O),t.BQk()),2&a){const e=o.$implicit,i=t.MAs(3);t.xp6(1),t.Q6J("ngIf",e.sortable)("ngIfElse",i)}}function pe(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"div",7)(1,"button",14),t.NdJ("click",function(n){t.CHM(e);const r=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.openPositionTagsDialog(n,r))}),t.TgZ(2,"mat-icon"),t._uU(3,"library_add"),t.qZA()()()}}function be(a,o){if(1&a){const e=t.EpF();t.TgZ(0,"div",7)(1,"button",14),t.NdJ("click",function(n){t.CHM(e);const r=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.openPositionTagsDialog(n,r))}),t.TgZ(2,"mat-icon",15),t._uU(3,"tag"),t.qZA(),t.TgZ(4,"span",16),t._uU(5),t.qZA()()()}if(2&a){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("matBadge",e.tags.length),t.xp6(3),t.Oqu(e.tags.length+" tags linked to this position")}}function ue(a,o){if(1&a&&(t.TgZ(0,"div",9)(1,"div",7)(2,"a",10),t._uU(3),t.qZA(),t.TgZ(4,"div",11),t._uU(5),t.qZA()(),t.TgZ(6,"div",7),t._uU(7),t.qZA(),t.TgZ(8,"div",7),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"div",7),t._uU(12),t.qZA(),t.TgZ(13,"div",7),t._uU(14),t.ALo(15,"currency"),t.qZA(),t.TgZ(16,"div",7),t._uU(17),t.qZA(),t.YNc(18,pe,4,0,"div",12),t.YNc(19,be,6,2,"ng-template",null,13,t.W1O),t.qZA()),2&a){const e=o.$implicit,i=t.MAs(20);t.xp6(2),t.Q6J("routerLink","/symbols/"+e.identifier.exchange+"-"+e.identifier.symbol),t.xp6(1),t.hij(" ",e.identifier.symbol," "),t.xp6(2),t.Oqu(e.companyName),t.xp6(2),t.Oqu(e.pctOfPortfolio+"%"),t.xp6(2),t.Oqu(t.xi3(10,10,e.price,e.currencyCode)),t.xp6(3),t.Oqu(e.yieldOnCost+"%"),t.xp6(2),t.Oqu(t.xi3(15,13,e.accumulatedDividends,e.currencyCode)),t.xp6(3),t.Oqu(e.upcomingDividendDate),t.xp6(1),t.Q6J("ngIf",0===e.tags.length)("ngIfElse",i)}}function he(a,o){if(1&a&&(t.ynx(0),t.YNc(1,ue,21,16,"div",8),t.BQk()),2&a){const e=o.ngIf;t.xp6(1),t.Q6J("ngForOf",e.positions)}}const me=[{path:"",component:(()=>{class a{constructor(e,i,n,r){this.portfolioPositionService=e,this.tagCategoryService=i,this.matDialog=n,this.store=r,this.defaultSort={active:"pctOfPortfolio",direction:"desc"},this.displayedColumns=[{name:"Ticker",sortable:!1,id:"ticker"},{name:"% Of Portfolio",sortable:!0,id:"pctOfPortfolio"},{name:"Cost Per Share",sortable:!1,id:"price"},{name:"Yield on Cost",sortable:!0,id:"yieldOnCost"},{name:"Accumulated Dividends",sortable:!1,id:"accumulatedDividends"},{name:"Upcoming Dividend Date",sortable:!1,id:"upcomingDividendDate"},{name:"Tags",sortable:!1,id:"tags"}],this.positions$=this.getPortfolioPositions()}ngOnInit(){this.initPositionsStore()}initPositionsStore(){this.portfolioPositionService.getPortfolioPositionsView(!0).pipe((0,ee.P)()).subscribe(e=>this.store.init(e,this.defaultSort))}getPortfolioPositions(){return this.portfolioPositionService.getPortfolioPositionsView(!0)}openPositionTagsDialog(e,i){this.matDialog.open(q,{restoreFocus:!1,disableClose:!1,data:{title:`${U(i.identifier)} Position Tags`,selectedTags:i.tags}}).afterClosed().subscribe(r=>{if(!r)return;if(r.openTagCategoriesDialog)return void this.matDialog.open(X,this.getTagCategoriesDialogConfig()).afterClosed().subscribe(_=>{_&&(_.add.length>0||_.update.length>0||_.delete.length>0)&&this.propagateTagCategoriesChanges(_)});const s=r.selectedTags;if(!s||JSON.stringify(s)===JSON.stringify(i.tags))return;const c=s.map(d=>d.id);this.portfolioPositionService.updatePositionTags(i.id,c).subscribe(()=>{this.store.updatePositionTags(i.id,s)})})}getTagCategoriesDialogConfig(){return{restoreFocus:!1,disableClose:!1}}propagateTagCategoriesChanges(e){const i=e.update.map(s=>this.tagCategoryService.updateTagCategory(s)),n=e.add.map(s=>this.tagCategoryService.createTagCategory(s)),r=e.delete.map(s=>this.tagCategoryService.deleteTagCategory(s));(0,te.D)([...i,...n,...r]).subscribe(()=>{this.initPositionsStore()})}sortPositions(e){this.store.reorderExistingPositions(e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(S),t.Y36(P.$),t.Y36(u.uw),t.Y36(L))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-positions-container-v2"]],decls:5,vars:6,consts:[["matSort","",1,"positions-list",3,"matSortActive","matSortDirection","matSortChange"],[1,"position-header-box","row"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","column",3,"mat-sort-header",4,"ngIf","ngIfElse"],["notSortable",""],[1,"column",3,"mat-sort-header"],[1,"column"],["class","position-box row",4,"ngFor","ngForOf"],[1,"position-box","row"],[1,"identifier-symbol",3,"routerLink"],[1,"identifier-company"],["class","column",4,"ngIf","ngIfElse"],["tags",""],["mat-button","",3,"click"],["matBadgeColor","accent",3,"matBadge"],[1,"cdk-visually-hidden"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.NdJ("matSortChange",function(r){return i.sortPositions(r)}),t.TgZ(1,"div",1),t.YNc(2,ge,4,2,"ng-container",2),t.qZA(),t.YNc(3,he,2,1,"ng-container",3),t.ALo(4,"async"),t.qZA()),2&e&&(t.Q6J("matSortActive",i.defaultSort.active)("matSortDirection",i.defaultSort.direction),t.xp6(2),t.Q6J("ngForOf",i.displayedColumns),t.xp6(1),t.Q6J("ngIf",t.lcZ(4,4,i.store.state$)))},dependencies:[h.sg,h.O5,I.yS,T.lW,y.Hw,se,R.YE,R.nU,h.Ov,h.H9],styles:[".positions-list[_ngcontent-%COMP%]{max-width:100%;border:solid 1px #ccc;min-height:60px;display:block;background:white;border-radius:4px;overflow:hidden;margin:0 5%}.position-header-box[_ngcontent-%COMP%]{color:#0009;align-items:center;box-sizing:border-box;background:white;font-size:12px;font-weight:700;padding:20px 0 0 10px;text-transform:uppercase}.position-box[_ngcontent-%COMP%]{border-bottom:solid 1px #ccc;color:#000000f7;align-items:center;box-sizing:border-box;background:white;font-size:14px;font-weight:500;padding:20px 10px}.identifier-company[_ngcontent-%COMP%]{font-size:small}.row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;flex-wrap:wrap;width:100%}.row[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]:first-child{align-items:flex-start}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;align-items:center}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.position-box[_ngcontent-%COMP%]:last-child{border:none}.positions-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .position-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0}),a})()}];let _e=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[I.Bz.forChild(me),I.Bz]}),a})();var k=l(9643),fe=l(4080);l(7340),l(3353);let Me=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[h.ez,p.BQ,fe.eL,p.si,k.Q8,x.rt,p.BQ]}),a})();var Ie=l(1572),Pe=l(3546);let N=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({}),a})(),He=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[N,p.si,p.BQ,k.Q8,N,p.BQ]}),a})();var je=l(2474);let Ze=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[S,L],imports:[h.ez,_e,T.ot,y.Ps,u.Is,Me,m.Hi,C.lN,g.UX,E.AV,Ie.Cq,le,D.Bb,Pe.QW,He,g.u5,f.To,A.c,je.I,R.JX]}),a})()}}]);